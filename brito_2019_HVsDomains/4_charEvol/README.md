# Reconstructing character evolution

This step of the pipeline uses the output of [Mesquite](https://www.mesquiteproject.org/) to reconstruct character (domain) evolution along a given phylogeny using `charEvol.py`. In the context of domain evolution, character states can be represented as a matrix of protein domain counts per genome, generated in the previous step by `domMatrix.py`. Based on such matrix, Mesquite can estimate events of character gain, loss and duplication along the branches of a tree using a Parsimony model. This model reconstructs the ancestral states (number of domains) at the internal nodes of trees, while minimising the number of changes (events) given the phylogeny and the matrix (domain distribution).


## Running Mesquite

First, download and install Mesquite [click here](https://www.mesquiteproject.org/Installation.html). For reconstructing the number of domains encoded by ancestral genomes, Mesquite requires as inputs: (1) a matrix of domain counts, and; (2) a species tree (Newick format), with taxa named as they appear in the matrix. To run the software, combine matrix and tree into Mesquite following the steps below:

1. Copy the entire content of the matrix generated by `domMatrix.py` in text format;
2. Open the target beast tree on Mesquite (File > Open File);
3. Go to Menu 'Characters' > 'Make new matrix from' > 'Clipboard' > Select 'Meristic' as data category. Also, to ensure the correct formatting of the matrix, below 'Data type', select 'Includes character names' and 'Includes taxon names'. Click 'Ok', name the matrix, and it will be shown as a tab.

Now, both tree and matrix are associated in the same 'Mesquite Project', allowing you to run a ['Character history' analysis](http://mesquiteproject.org/mesquiteArchives/mesquite2.75/Mesquite_Folder/docs/mesquite/CharacterEvolution/AncestralStates.html). To do so:

4. Select the tab containing the tree, and access the menu 'Analysis:Tree' > 'Trace all characters'. Select 'Parsimony Ancestral state' as the reconstruction method;
5. Make sure the terminal nodes (tips of the tree) are represented in the matrix: access the menu 'Trace_All', and select 'Show Terminal Nodes';
6. Select the tab containing the new matrix content ('Trace All Characters'), and save it as a text file at 'File' > 'Save Window as Text'.

## Running charEvol.py

After running Mesquite, your working directory may contain all files required for running `charEvol.py` with a command line similar to the one shown below:

```
python charEvol.py '/path/to/input/files/' beastTree originalMatrix mesquiteMatrix 
```

where `beastTree` is a time-calibrated beast tree; `originalMatrix` is the one generated by `domMatrix.py`;  and `mesquiteMatrix` is the file exported at the step 6 described above. As a result, the working directory will now include a 'reconstructions' folder with information about a plausible scenario explaining the dynamics of domain evolution, where one can find two folders:
* 'iTOL_annotations': showing 'domain' and 'label' files to annotate iTOL trees ([click here](https://itol.embl.de/tree/13013217350409021551825529#) to see an example), and;
* 'raw_data': showing a set of files containing lists of reconstructed events; domains involved in distinct events (gains, losses, and duplications); as well as custom domain legends.

See the `examples` directory for more details about input and output files.

## Authors

* **Anderson Brito** - [WebPage](https://andersonbrito.github.io/) - andersonfbrito@gmail.com

## License

This project is licensed under the MIT License.

